<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>AutoFinance - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body class="m-0">
    <!-- Navbar -->
    <div class="container-fluid bg-dark text-white py-3">
        <div class="d-flex justify-content-between align-items-center px-4">
            <h2><i class="bi bi-graph-up-arrow"></i> AutoFinance</h2>
            <form action="{{ url_for('logout') }}" method="POST">
                <button type="submit" class="btn btn-light">
                    <i class="bi bi-box-arrow-right"></i> Sair
                </button>
            </form>
        </div>
    </div>
    <div class="container py-4">
      <!-- Cards de resumo financeiro -->
      <div class="row g-4 mb-4">
        <!-- Card de resumo saldo (receitas - despesas) -->
          <div class="col-md-4">
              <div class="card p-3 shadow-sm rounded-0">
                  <h5><i class="bi bi-wallet2"></i> Saldo Atual</h5>
                  <p class="fs-4">R$ {{ saldo }}</p>
              </div>
          </div>
          <!-- Card de resumo despesas (valores de saída) -->
          <div class="col-md-4">
              <div class="card p-3 shadow-sm rounded-0">
                  <h5><i class="bi bi-arrow-down-circle"></i> Despesas</h5>
                  <p class="fs-4 text-danger">R$ {{ despesas }}</p>
              </div>
          </div>
          <!-- Card de resumo receitas (valores de entrada) -->
          <div class="col-md-4">
              <div class="card p-3 shadow-sm rounded-0">
                  <h5><i class="bi bi-arrow-up-circle"></i> Receitas</h5>
                  <p class="fs-4 text-success">R$ {{ receitas }}</p>
              </div>
          </div>
      </div>

      <!-- Card da Reserva de Emergência -->
      <div class="row mb-4">
          <div class="col-md-12">
              <div class="card p-3 shadow-sm rounded-0">
                  <h5><i class="bi bi-shield-check"></i> Reserva de Emergência</h5>
                  <p>Custo mensal essencial: R$ {{ custo_mensal }}</p>
                  <p>Meta da reserva (3 meses): R$ {{ meta_reserva }}</p>

                  <!-- Guardar valor (reserva de emergência) -->
                  <form action="{{ url_for('guardar_reserva') }}" method="POST" class="d-flex gap-2 mt-3">
                      <input type="number" step="0.01" name="valor" class="form-control" placeholder="Valor a guardar" required>
                      <button type="submit" class="btn btn-warning rounded-0">
                          <i class="bi bi-piggy-bank"></i> Guardar
                      </button>
                  </form>
              </div>    
          </div>
      </div>

      <!-- Tabela de lançamentos (despesas e receitas) -->
      <div class="card p-3 shadow-sm mb-4 rounded-0">
          <h5><i class="bi bi-list-ul"></i> Últimos lançamentos</h5>
          <table class="table table-dark table-striped mt-3">
              <thead>
                  <tr>
                      <th>Data</th>
                      <th>Descrição</th>
                      <th>Categoria / Origem</th>
                      <th>Valor</th>
                      <th>Ações</th>
                  </tr>
              </thead>
              <tbody>
                  {% for item in itens %}
                  <tr>
                      <td>{{ item.data }}</td>
                      <td>{{ item.descricao }}</td>
                      <td>{{ item.categoria }}</td>
                      <td class="{% if item.tipo == 'despesa' %}text-danger{% else %}text-success{% endif %}">
                          {% if item.tipo == 'despesa' %}-{% else %}+{% endif %} R$ {{ item.valor }}
                      </td>
                      <td>
                          <form action="{{ url_for('remover', item_id=item._id) }}" method="POST" style="display:inline;">
                              <button type="submit" class="btn btn-danger btn-sm"><i class="bi bi-trash"></i></button>
                          </form>
                      </td>
                  </tr>
                  {% endfor %}
              </tbody>
          </table>
      </div>

      <!-- Botões de ação -->
      <div class="text-center mb-4 d-flex justify-content-center gap-3">
          <button class="btn btn-success btn-lg rounded-0" data-bs-toggle="modal" data-bs-target="#modalReceita">
              <i class="bi bi-plus-circle"></i> Adicionar Receita
          </button>

          <button class="btn btn-danger btn-lg rounded-0" data-bs-toggle="modal" data-bs-target="#modalDespesa">
              <i class="bi bi-dash-circle"></i> Adicionar Despesa
          </button>
          <button class="btn btn-primary btn-lg rounded-0" data-bs-toggle="modal" data-bs-target="#modalSalario">
              <i class="bi bi-cash-coin"></i> Definir Salário Bruto
          </button>

          <!-- Botão de direcionamento para a página de gráficos -->
          <a href="{{ url_for('graficos') }}" class="btn btn-info btn-lg rounded-0">
              <i class="bi bi-bar-chart"></i> Ver Gráficos
          </a>
        <!-- Novo botão para importar CSV -->
        <button class="btn btn-warning btn-lg rounded-0" data-bs-toggle="modal" data-bs-target="#modalCSV">
            <i class="bi bi-file-earmark-spreadsheet"></i> Importar CSV
        </button>
      </div>
      <!-- Modal de Importação CSV -->
      <div class="modal fade" id="modalCSV" tabindex="-1" aria-labelledby="modalCSVLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content bg-dark text-white">
            <div class="modal-header">
              <h5 class="modal-title" id="modalCSVLabel">Insira aqui o caminho do seu arquivo</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <form method="POST" action="{{ url_for('rota_extrair_csv') }}">
              <div class="modal-body">
                <div class="mb-3">
                  <label for="caminho_csv" class="form-label">Caminho do arquivo CSV</label>
                  <input type="text" name="caminho_csv" id="caminho_csv"
                        class="form-control border-0 border-bottom border-white bg-transparent text-white" required>
                </div>
                {% if erro_csv %}
                  <div class="alert alert-danger text-center">{{ erro_csv }}</div>
                {% endif %}
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-light">Avançar</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- Modal Salário -->
      <div class="modal fade" id="modalSalario" tabindex="-1" aria-labelledby="modalSalarioLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content bg-dark text-white">
            <div class="modal-header">
              <h5 class="modal-title" id="modalSalarioLabel">Definir Salário Bruto</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <form action="{{ url_for('salvar_salario_route') }}" method="POST">
              <!-- Campos ocultos para identificar o salário definido-->
              <input type="hidden" name="tipo" value="salario">
              <input type="hidden" name="categoria" value="Salário">

              <div class="modal-body">
                <div class="mb-3">
                  <label for="valorSalario" class="form-label">Valor do Salário</label>
                  <input type="number" step="0.01" class="form-control" id="valorSalario" name="salario" required>
                </div>
                <div class="mb-3">
                  <label for="dataSalario" class="form-label">Data</label>
                  <input type="date" class="form-control" id="dataSalario" name="data" required>
                </div>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="submit" class="btn btn-primary">Salvar Salário</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <!-- Modal Receita -->
      <div class="modal fade" id="modalReceita" tabindex="-1" aria-labelledby="modalReceitaLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content bg-dark text-white">
            <div class="modal-header">
              <h5 class="modal-title" id="modalReceitaLabel">Nova Receita</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <form action="{{ url_for('adicionar') }}" method="POST">
              <div class="modal-body">
                <input type="hidden" name="tipo" value="receita">
                <div class="mb-3">
                  <label for="descricaoReceita" class="form-label">Origem da Receita</label>
                  <input type="text" class="form-control" id="descricaoReceita" name="descricao" required>
                </div>
                <div class="mb-3">
                  <label for="valorReceita" class="form-label">Valor</label>
                  <input type="number" step="0.01" class="form-control" id="valorReceita" name="valor" required>
                </div>
                <div class="mb-3">
                  <label for="dataReceita" class="form-label">Data</label>
                  <input type="date" class="form-control" id="dataReceita" name="data">
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="submit" class="btn btn-success">Salvar Receita</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Modal Despesa -->
      <div class="modal fade" id="modalDespesa" tabindex="-1" aria-labelledby="modalDespesaLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content bg-dark text-white">
            <div class="modal-header">
              <h5 class="modal-title" id="modalDespesaLabel">Nova Despesa</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <form action="{{ url_for('salvar_salario_route') }}" method="POST">
              <div class="modal-body">
                <input type="hidden" name="tipo" value="despesa">
                <div class="mb-3">
                  <label for="descricaoDespesa" class="form-label">Descrição</label>
                  <input type="text" class="form-control" id="descricaoDespesa" name="descricao" required>
                </div>
                <div class="mb-3">
                  <label for="valorDespesa" class="form-label">Valor</label>
                  <input type="number" step="0.01" class="form-control" id="valorDespesa" name="valor" required>
                </div>
                <div class="mb-3">
                  <label for="categoriaDespesa" class="form-label">Categoria</label>
                  <select class="form-select" id="categoriaDespesa" name="categoria" required>
                    {% for cat in categorias %}
                      <option value="{{ cat }}">{{ cat }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="mb-3">
                  <label for="dataDespesa" class="form-label">Data</label>
                  <input type="date" class="form-control" id="dataDespesa" name="data" required>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="submit" class="btn btn-danger">Salvar Despesa</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>